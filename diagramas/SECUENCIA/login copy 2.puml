@startuml
' Estilo visual
skinparam sequenceArrowColor #4682B4
skinparam actorBorderColor #8B4513
skinparam actorBackgroundColor #FFFACD
skinparam participantBorderColor #4682B4
skinparam participantBackgroundColor #E6E6FA

actor "Usuario" as User
boundary "Edit" as EditView
boundary "Index" as IndexView
control "UserController" as Controller
entity "users" as DB

== Gestión de Usuarios (Parte 2) ==

alt Usuario es administrador
    ' Editar usuario existente
    User -> EditView : acceder(id)
    EditView -->> User : vistaFormularioEdición

    EditView -> Controller : update(id, nuevosDatos)
    Controller -->> EditView : datosRecibidos

    Controller -> DB : actualizarUsuario(id)
    DB -->> Controller : usuarioActualizado

    Controller -> IndexView : redirigirConListaActualizada()
    IndexView -->> Controller : listaRedirigida

    ' Asignar roles
    User -> EditView : asignarRoles(id)
    EditView -->> User : vistaRolesCargada

    EditView -> Controller : asignarRoles(id, roles)
    Controller -->> EditView : datosRolesRecibidos

    Controller -> DB : actualizarUsuarioRoles()
    DB -->> Controller : rolesActualizados

    Controller -> IndexView : redirigirConListaActualizada()
    IndexView -->> Controller : listaRedirigida

    ' Desactivar usuario
    User -> EditView : desactivarUsuario(id)
    EditView -->> User : vistaConfirmaciónDesactivación

    EditView -> Controller : cambiarEstadoUsuario(id)
    Controller -->> EditView : cambioSolicitado

    Controller -> DB : actualizarEstado()
    DB -->> Controller : estadoActualizado

    Controller -> IndexView : redirigirConListaActualizada()
    IndexView -->> Controller : listaRedirigida

    ' Restablecer contraseña (no redirige)
    User -> EditView : restablecerContraseña(id)
    EditView -->> User : vistaRestablecimiento

    EditView -> Controller : generarTokenRestablecimiento(id)
    Controller -->> EditView : tokenGenerado
end
@enduml
